@using Microsoft.AspNet.Identity
@model VideoOnDemand.Web.Models.MovieViewModel

@{
    ViewBag.Title = "Details";
}
<style>
    .star {
        direction: rtl;
    }

    .star label:hover,
    .star label:hover ~ label {
        color: yellowgreen;
    }
    input[type="radio"]:checked ~ label {
        color: orange;
    }
</style>
<div class="container">

    <div id="general">
        <div id="imagen">
            <img src="~/images/sample.PNG" alt="" width="390" height="265" />
        </div>
        <div id="detalles">
            <h3>
                <strong>
                    @Html.DisplayFor(m => m.nombre)
                    (@Html.DisplayFor(m => m.fechaLanzamiento.Value.Year))
                </strong>
            </h3>
            @{
                int? hrs = Model.duracionMin / 60;
                int? min = Model.duracionMin - (hrs * 60);
                string aux = "";
                string auxh = "";
                if (min < 10)
                {
                    aux = "0";
                }
                if (hrs < 10)
                {
                    auxh = "0";
                }
            }

            <h4>@auxh@hrs h @aux@min m</h4>

            <h4>
                <strong>Descrpción: </strong>
                @Html.DisplayFor(m => m.descripcion)
            </h4>
            @{
                string gen = "";
                foreach (var g in Model.Generos)
                {
                    gen += g.Nombre + ", ";
                }
            }
            <h4>
                <strong>Género: </strong>
                @gen
            </h4>
            @{
                string act = "";
                foreach (var g in Model.Actores)
                {
                    act += g.Nombre + ", ";
                }
            }
            <h4>
                <strong>Actores: </strong>
                @act
            </h4>
            <div id="leftAll">
                <h4>
                    <button id="btnMiLista" type="button" class="btn btn-defaul">+ Mi Lista</button>
                    @Html.ActionLink("> Repoducir", "Details", new { id = Model.id }, new { @class = "btn btn-default" })
                </h4>
            </div>
        </div>
    </div>


</div>
<h2></h2>
<h3>@ViewBag.CountResenias Reseñas</h3>
<div class="container" style="padding-top: 18px;">
    <div class="form-group" style="border: 1px solid; ">
        <label for="txtArea" style="padding-top: 10px; padding-left: 20px;">Mi Reseña</label><label id="identityiduser" style="display:none;">@User.Identity.GetUserId()</label>
        <center>
            <textarea id="txtAreaResenia" class="form-control" style="width: 95%; height:80px; max-width: 100%; padding-left: 20px; padding-top: 10px;" placeholder="Agrega una reseña"></textarea>
        </center>
        <div class="form-horizontal">
            <form id="puntuacion" style="padding-top: 10px; padding-right: 40px; ">
                <p class="star">
                   
                    <button id="btnAgregar" type="button" class="btn btn-defaul">Agregar</button>
                    <input id="radio1" type="radio" name="estrellas" style="display:none;" value="5">
                    <label for="radio1" style="font-size: 20px;">★</label>
                    <input id="radio2" type="radio" name="estrellas" style="display:none;" value="4">
                    <label for="radio2" style="font-size: 20px;">★</label>
                    <input id="radio3" type="radio" name="estrellas" style="display:none;" value="3">
                    <label for="radio3" style="font-size: 20px;">★</label>
                    <input id="radio4" type="radio" name="estrellas" style="display:none;" value="2">
                    <label for="radio4" style="font-size: 20px;">★</label>
                    <input id="radio5" type="radio" name="estrellas" style="display:none;" value="1">
                    <label for="radio5" style="font-size: 20px;">★</label>
                </p>
            </form>
        </div>
    </div>
</div>

@foreach (var opinion in ViewBag.Resenias)
{
    <div class="container" style="padding-top: 10px;">
        <div class="form-group" style="border: 1px solid; padding-left:15px; padding-right: 15px;">
            <label style="padding-top: 10px;">@opinion.Usuario.Nombre     -     </label>
            <label style="padding-top: 10px;">@opinion.FechaRegistro         </label>
            <label style="padding-top: 10px; padding-left: 50px; padding-right: 20px;">
                @for (int i = 0; i < opinion.Puntuacion; i++)
                {
                    <label style="font-size: 20px;">&#9733;</label>
                }
            </label>
            <p>
                @opinion.Descripcion
            </p>
        </div>
    </div>
}

<br />
<br />

<div class="container">
    @Html.ActionLink("Regresar", "Index")
</div>

@section Scripts{
    <script type="text/javascript">
        $(function () {
            $("#btnAgregar").click(function () {
                guardarOpinion();
            });
            $("#btnMiLista").click(function () {

            });

            $(".datepicker").datepicker({
                language: "es",
                autoclose: true
            });


        });

        function guardarOpinion() {

            var opinion = {
                Puntuacion: parseInt($('input[name=estrellas]:checked', '#puntuacion').val()),
                Descripcion: $("#txtAreaResenia").val(),
                IdentityId: $("#identityiduser").text(),
                MediaId: parseInt(@Model.id)
            };
             $.ajax({
                 url: '@Url.Action("AddResenia", "Movie")',
                 type: 'POST',
                 dataType: 'JSON',
                 contentType: "application/json",
                 data: JSON.stringify(opinion),
                 success: function (data) {
                     if (!data.success) {
                         alert("Opinion Agregada");
                     } else {
                         alert("Verifique su reseña");
                     }
                 }
             });
        }

        function AgregarLista() {

        }
    </script>

}